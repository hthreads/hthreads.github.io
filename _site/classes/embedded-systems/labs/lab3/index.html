<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lab 3 | HThreads</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Lab 3" /><meta name="author" content="Kevin Lin" /><meta property="og:locale" content="en_US" /><meta name="description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><meta property="og:description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><link rel="canonical" href="http://localhost:4000/classes/embedded-systems/labs/lab3/" /><meta property="og:url" content="http://localhost:4000/classes/embedded-systems/labs/lab3/" /><meta property="og:site_name" content="HThreads" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lab 3" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kevin Lin"},"description":"A modern, highly customizable, responsive Jekyll template for course websites","headline":"Lab 3","url":"http://localhost:4000/classes/embedded-systems/labs/lab3/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> HThreads </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Classes category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/" class="nav-list-link">Classes</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in CSCE 4213 Computer Architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/computer-architecture/" class="nav-list-link">CSCE 4213 Computer Architecture</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/computer-architecture/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/computer-architecture/schedule/" class="nav-list-link">Schedule</a></ul><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in CSCE 4114 Embedded Systems category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/embedded-systems/" class="nav-list-link">CSCE 4114 Embedded Systems</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/embedded-systems/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/embedded-systems/schedule/" class="nav-list-link">Schedule</a><li class="nav-list-item "> <a href="/classes/embedded-systems/labs/" class="nav-list-link">Labs</a></ul></ul><li class="nav-list-item"><a href="/people/" class="nav-list-link">People</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Projects category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/projects/" class="nav-list-link">Projects</a><ul class="nav-list"><li class="nav-list-item "><a href="/projects/picaso/" class="nav-list-link">PiCaSO</a></ul><li class="nav-list-item"><a href="/publications/" class="nav-list-link">Publications</a><li class="nav-list-item"><a href="/schedule/" class="nav-list-link">Schedule</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search HThreads" aria-label="Search HThreads" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="">CSCE 4114 Embedded Systems</a><li class="breadcrumb-nav-list-item"><a href="">Labs</a><li class="breadcrumb-nav-list-item"><span>Lab 3</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="lab-3-fayetteville-bike-crossing"> <a href="#lab-3-fayetteville-bike-crossing" class="anchor-heading" aria-labelledby="lab-3-fayetteville-bike-crossing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab 3: Fayetteville Bike Crossing</h1><p>In this lab you will use your Arty-7 board and knowledge of push buttons and LEDs from the previous lab to create a controller for Fayettevilleâ€™s bike/waking paths. The bike/walking path crosses streets where cyclists/walkers have a control box they can use to control the traffic lights for cars</p><p>Cyclist/Walker control Boxes: One on each side of the path that crosses the road. Cyclists/Walkers push the button in the box to request a crossing and control the traffic lights.</p><p><strong>Traffic Lights:</strong></p><ol><li>Solid Green: Cars are free to travel through the crossing at speed. This signifies no cyclists/walkers have requested a crossing.<li>Solid Red: Cars must stop. This signifies a cyclist/walker is in the crosswalk.<li>Blinking Red: Cars must slow and look for cyclists/walkers. A blinking red occurs prior to and immediately following a solid red light.</ol><p>Operation and control of the push button control box: When a cyclist/walker pushes the button in the control box:</p><ol><li>If the traffic lights are green they immediately start flashing red for 6 seconds<li>If the traffic lights are already flashing red the new button push will flash for an additional 6 seconds from the time of the new button push.<li>If the traffic lights are solid red, the button push will have no effect and the solid red will display for 4 seconds from the first button push.</ol><p>So the states in order go: green â†’ blinking red â†’ solid red â†’ blinking red â†’ green. In general, any of the push buttons should activate the crosswalk logic, but all 4 RGB LEDs should be used for the status for the cars.</p><h2 id="lab-directions"> <a href="#lab-directions" class="anchor-heading" aria-labelledby="lab-directions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab Directions</h2><p>This is a two part lab that will run in two weeks. In the first week you will have to simulate the 4 and 6-second delays using dummy loops. In the second week you will replace the dummy loops with a timer.</p><ul><li><strong>Week 1.</strong> In the first week you will write the code to control two push buttons signifying the two cyclist/walkers control boxes and two LEDs signifying the traffic lights. After a control box is pushed, the traffic lights automatically transition between blinking red, solid red, blinking red, and then back to green. You will need to simulate this transition using delay loops. Ie., after a button is pushed the blinking red should appear for approximately 6 seconds, then switch to solid red for 4 seconds, back to blinking red for 6 seconds, and then back to green. Since you donâ€™t have timers you will have to write nested loops that essentially do nothing useful but delay for the appropriate amount of time (approximately, can be a little fast or slow) before switching to the next color.</ul><p>You will also have to blink the red LED on and off at approximately 1 second intervals to simulate the flashing red.</p><p><strong>Step 1:</strong></p><p>In SDK, create a new blank Application project using the base-soc.sdk workspace like in last lab. Create a lab3.c file and populate it with the necessary empty main() function and includes.</p><ol><li>To start off, we can see this lab is going to utilize waiting in varying time intervals based around the second unit. It would probably be helpful if we created a function to wait for us. Letâ€™s make a <code class="language-plaintext highlighter-rouge">delay_ms(int ms)</code> function, so we can reuse it in other portions of this lab and possible future labs:<ul><li>Copy/paste the following to your source code file:</ul></ol><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">delay_ms</span><span class="p">(</span><span class="kt">int</span> <span class="n">ms</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">134</span> <span class="o">*</span> <span class="n">ms</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> 
  <span class="p">{</span> 
    <span class="n">asm</span><span class="p">(</span><span class="s">"nop"</span><span class="p">);</span> 
  <span class="p">}</span> 
<span class="p">}</span>
</code></pre></div></div><p><em>You may need to tweak the loop so that it approximates a second when delay_ms(1000) is called.</em></p><p>Now that you have a working delay function, you can delay for one second by calling <code class="language-plaintext highlighter-rouge">delay_ms(1000);</code> in your main function. Create a <code class="language-plaintext highlighter-rouge">while(1)</code> section in your main function and create the desired functionality described above using what you have learned from last lab. It would be helpful to break the individual sub-routines down into functions for organization and modularity.</p><p><strong>Step 2:</strong></p><p>You will factor your code into a Finite State Machine model for creating state transitions. You should be familiar with FSM models from Digital Design and System Synthesis. At a high level, an FSM is an abstract machine or mathematical model that describes the transitions from a current state and set of inputs to a next state with a set of outputs. FSMs are very convenient for modeling and implementing the behaviors of embedded and real time systems as a series of transitions that result from the presence of external inputs (sensors, buttons) that result in the setting of external outputs (actuators, relays etc). You should have some experience from Digital Design and System Synthesis in writing Moore and Mealy FSMs in Verilog or VHDL. We can model an FSM in C using the switch(), case 1, case 2â€¦ constructs.</p><p>Below is a skeleton template (not complete) of an FSM for the Fayetteville bike crossing.</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">enum</span> 
<span class="p">{</span><span class="n">RED</span><span class="p">,</span> <span class="n">GREEN</span><span class="p">,</span> <span class="n">FLASH_RED_START</span><span class="p">,</span> <span class="n">FLASH_RED_END</span><span class="p">}</span> <span class="n">State</span><span class="p">;</span> 

<span class="c1">// Create state variables </span>
<span class="n">State</span> <span class="n">state</span><span class="p">,</span> <span class="n">next_state</span><span class="p">;</span>

<span class="c1">// Basic template for FSM model </span>
<span class="kt">void</span> <span class="nf">FSM_tick</span><span class="p">()</span> 
<span class="p">{</span> 
  <span class="k">switch</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> 
  <span class="p">{</span> 
    <span class="k">case</span> <span class="n">RED</span><span class="p">:</span> 
      <span class="c1">// code for RED state &amp; logic for next_state</span>
      <span class="n">next_state</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span> <span class="c1">// next state after RED </span>
      <span class="k">break</span><span class="p">;</span> 
    <span class="k">case</span> <span class="n">GREEN</span><span class="p">:</span> 
      <span class="c1">// code for GREEN state &amp; logic for next_state</span>
      <span class="n">next_state</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span> <span class="c1">// next state after GREEN</span>
      <span class="k">break</span><span class="p">;</span> 
    <span class="k">case</span> <span class="n">FLASH_RED_START</span><span class="p">:</span> 
      <span class="c1">// code for FLASH_RED_START state &amp; logic for next_state </span>
      <span class="n">next_state</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span> <span class="c1">// next state after RED_START</span>
      <span class="k">break</span><span class="p">;</span> 
    <span class="k">case</span> <span class="n">FLASH_RED_END</span><span class="p">:</span> 
      <span class="c1">// code for FLASH_RED_END state &amp; logic for next_state </span>
      <span class="n">next_state</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span> <span class="c1">// next state after FLASH_RED_END </span>
      <span class="k">break</span><span class="p">;</span> 
  <span class="p">}</span> 
  <span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span><span class="p">;</span> <span class="c1">// update next state </span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span> 
  <span class="c1">// initialize crossing to a state from the enum</span>
  <span class="n">state</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span> 
  
  <span class="c1">// keep on loopin' </span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
  <span class="p">{</span> 
    <span class="c1">// cycle through traffic light pattern </span>
    <span class="n">FSM_tick</span><span class="p">();</span> 
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></div></div><h2 id="submission"> <a href="#submission" class="anchor-heading" aria-labelledby="submission"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Submission</h2><p>Nothing will be due for the first week, though you should double-check your design and ensure it produces the desired output. Make sure your design is modular as well as we will refactor this code and use timers in place of the dummy delay loops in the second week. For the submission after week 2, you will turn in your report which should contain a state transition graph of your FSM, and your C file in a zip archive.</p></div></div><div class="search-overlay"></div></div>
