<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lab 7 | HThreads</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Lab 7" /><meta name="author" content="Kevin Lin" /><meta property="og:locale" content="en_US" /><meta name="description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><meta property="og:description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><link rel="canonical" href="http://localhost:4000/classes/embedded-systems/labs/lab7/" /><meta property="og:url" content="http://localhost:4000/classes/embedded-systems/labs/lab7/" /><meta property="og:site_name" content="HThreads" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lab 7" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kevin Lin"},"description":"A modern, highly customizable, responsive Jekyll template for course websites","headline":"Lab 7","url":"http://localhost:4000/classes/embedded-systems/labs/lab7/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> HThreads </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Classes category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/" class="nav-list-link">Classes</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in EECS 4213 Computer Architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/computer-architecture/" class="nav-list-link">EECS 4213 Computer Architecture</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/computer-architecture/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/computer-architecture/schedule/" class="nav-list-link">Schedule</a></ul><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in EECS 4114 Embedded Systems category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/embedded-systems/" class="nav-list-link">EECS 4114 Embedded Systems</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/embedded-systems/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/embedded-systems/schedule/" class="nav-list-link">Schedule</a><li class="nav-list-item "> <a href="/classes/embedded-systems/labs/" class="nav-list-link">Labs</a></ul></ul><li class="nav-list-item"><a href="/people/" class="nav-list-link">People</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Projects category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/projects/" class="nav-list-link">Projects</a><ul class="nav-list"><li class="nav-list-item "><a href="/projects/picaso/" class="nav-list-link">PiCaSO</a></ul><li class="nav-list-item"><a href="/publications/" class="nav-list-link">Publications</a><li class="nav-list-item"><a href="/schedule/" class="nav-list-link">Schedule</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search HThreads" aria-label="Search HThreads" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"> <a href="/classes/">Classes</a><li class="breadcrumb-nav-list-item"> <a href="/classes/embedded-systems/">EECS 4114 Embedded Systems</a><li class="breadcrumb-nav-list-item"> <a href="/classes/embedded-systems/labs/">Labs</a><li class="breadcrumb-nav-list-item"> <span>Lab 7</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="lab-7-freertos"> <a href="#lab-7-freertos" class="anchor-heading" aria-labelledby="lab-7-freertos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab 7: FreeRTOS</h1><h2 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction</h2><p>When determining which scheduling solution your embedded system should use, there are a variety of options that range from a simplistic bare-metal design, like we used in lab 6, to a full embedded Linux distribution (called PetaLinux). Choosing one may come down to factors like:</p><ul><li><strong>Responsiveness and compatibility:</strong> Companies like TI and Xilinx may create their own RTOS (e.g. TI-RTOS or XilKernel <em>[<a href="https://support.xilinx.com/s/article/69214?language=en_US">discontinued…</a>]</em>) that work best on the hardware they design. Some also follow POSIX standards such that maximum compatibility exists for programming between different devices (e.g.: You can create pthreads on your computer, as well as TI-RTOS and XilKernel as they are POSIX compliant, but not the standard FreeRTOS).<li><strong>System resources:</strong> Larger embedded systems may have multi-core systems that support embedded Linux or a combination of systems (PetaLinux + FreeRTOS).<li><strong>Licensing:</strong> Certain software packages like Azure RTOS and others commercially available for cloud IoT uses require licensing.</ul><p>For this lab, we will be using <a href="https://www.freertos.org">FreeRTOS</a> to convert our bare-metal task switcher into a full RTOS-driven system that supports task preemption and has a programming feel that is closer to that of programming multi-threaded programs for computers. FreeRTOS has been described as “the de facto standard” and “market leading” because of its robustness, the wide range of microprocessors supported, and lack of a license needed to use it. Xilinx has deprecated the use of their “XilKernel” system and have since removed it in SDK version 2017.1 and onwards. FreeRTOS provides a small, robust, and modular kernel. It is highly integrated with the Xilinx SDK and is a free software library option that can be selected when creating a new project. It allows a very high degree of customization, letting users tailor the kernel to an optimal level both in terms of size and functionality with most modifications readily available in the “FreeRTOS.h” and “FreeRTOSConfig.h” header files. It supports the core features required in a lightweight embedded kernel, however, the version included with the Xilinx SDK is not POSIX compliant and does not support pthreads. FreeRTOS can be used to implement higher level services (such as networking, video, and audio) and subsequently run applications using these services.</p><blockquote class="note"><p>We will be using the same SDK workspace from previous labs to create the FreeRTOS project and migrate our traffic signal from the bare-metal design.</p></blockquote><h2 id="project-directions"> <a href="#project-directions" class="anchor-heading" aria-labelledby="project-directions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project Directions</h2><ol><li>Open your workspace from previous labs and go to <code class="language-plaintext highlighter-rouge">File &gt; New &gt; Application Project</code>.<li>In the <strong>“New Project”</strong> preferences window, name the project (e.g. “lab7”) and for the <strong>“OS Platform”</strong> selection, choose <code class="language-plaintext highlighter-rouge">freertos10_xilinx</code>. Click <strong>Next</strong> and choose the empty project option, then click <strong>Finish</strong>.<blockquote><p><em>If you are using a different version of the SDK, your version of FreeRTOS may vary.</em></p></blockquote><li><p>In the newly created project, right-click on the <code class="language-plaintext highlighter-rouge">src</code> folder and create a new source file <code class="language-plaintext highlighter-rouge">New &gt; Source File</code>. Name the file “main.c” and paste the following code in it as a starting point:</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/* FreeRTOS includes. */</span>
 <span class="cp">#include "FreeRTOS.h"
</span> <span class="cp">#include "task.h"
</span> <span class="cp">#include "semphr.h"
</span> <span class="cm">/* Xilinx includes. */</span>
 <span class="cp">#include "xil_printf.h"
</span> <span class="cp">#include "xparameters.h"
</span> <span class="cp">#include "xgpio.h"
</span> <span class="cp">#include "xintc.h"
</span>    
 <span class="c1">// Traffic light states</span>
 <span class="k">typedef</span> <span class="k">enum</span>
 <span class="p">{</span>
     <span class="n">GREEN</span><span class="p">,</span>
     <span class="n">RED</span><span class="p">,</span>
     <span class="n">RED_BLINK_START</span><span class="p">,</span>
     <span class="n">RED_BLINK_END</span>
 <span class="p">}</span> <span class="n">State</span><span class="p">;</span>
    
 <span class="c1">// Default state</span>
 <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">GREEN</span><span class="p">;</span>
    
 <span class="c1">// Shared resource. Mutex driven.</span>
 <span class="n">SemaphoreHandle_t</span> <span class="n">state_mutex</span><span class="p">;</span>
    
 <span class="cm">/* FreeRTOS Tasks */</span>
    
 <span class="cm">/* Main Function */</span>
 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="c1">// Setup and init code</span>
    
     <span class="c1">// Start FreeRTOS Kernel</span>
    
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div><blockquote class="info"><p>We will attempt to develop our traffic light with a structure similar to the traffic signal from previous labs. Let’s attempt to first migrate part of the <code class="language-plaintext highlighter-rouge">taskChoose</code> thread that was used in the previous lab to govern when the other tasks were supposed to run.</p></blockquote><li>To create a thread in FreeRTOS, we first need to create a task handle struct that the kernel will use to associate a task with. Above <code class="language-plaintext highlighter-rouge">main()</code>, create a handle called SupervisorTaskHandle and initialize it to null: <code class="language-plaintext highlighter-rouge">TaskHandle_t SupervisorTaskHandle = NULL;</code><li>Next, we need to create a task handler function that will be executed for the supervisor task. Similar to last lab, create a function that will act as a thread runner that takes in a void pointer parameter: <code class="language-plaintext highlighter-rouge">void SupervisorTask(void *arg){...}</code>. Fill out the body of this function with just an infinite loop.<li>Now we are going to formally create the supervisor task with <code class="language-plaintext highlighter-rouge">xCreateTask</code>. This macro has the following parameters: <code class="language-plaintext highlighter-rouge">xCreateTask(pvTaskCode, pcName, usStackDepth, pvParameters, uxPriority, pxCreatedTask)</code>. These parameters are explained by hovering over the macro name, right-clicking, and opening the declaration (or F3). The parameter details are also provided below:<ul><li><strong>pvTaskCode</strong> Pointer to the task entry function. Tasks must be implemented to never return (i.e. continuous loop).<li><strong>pcName</strong> A descriptive name for the task. This is mainly used to facilitate debugging. The max length is defined by <code class="language-plaintext highlighter-rouge">configMAX_TASK_NAME_LEN</code> - default is 10. (e.g. “Supervisor”)<li><strong>usStackDepth</strong> The size of the task stack specified as the number of variables the stack can hold - not the number of bytes. For example, if the stack is 16 bits wide and <code class="language-plaintext highlighter-rouge">usStackDepth</code> is defined as 100, 200 bytes will be allocated for stack storage.<li><strong>pvParameters</strong> Pointer that will be used as the parameter for the task being created.<li><strong>uxPriority</strong> The priority at which the task should run. Systems that include MPU support can optionally create tasks in a privileged (system) mode by setting bit <code class="language-plaintext highlighter-rouge">portPRIVILEGE_BIT</code> of the priority parameter. For example, to create a privileged task at priority 2 the <code class="language-plaintext highlighter-rouge">uxPriority</code> parameter should be set to <code class="language-plaintext highlighter-rouge">( 2 | portPRIVILEGE_BIT )</code>.<li><strong>pvCreatedTask</strong> Used to pass back a handle by which the created task can be referenced.<li>So, in the <code class="language-plaintext highlighter-rouge">main</code> function, our call to <code class="language-plaintext highlighter-rouge">xTaskCreate</code> will look like:<br /> <code class="language-plaintext highlighter-rouge">xTaskCreate(SupervisorTask, "Supervisor", configMINIMAL_STACK_SIZE, NULL, tskIDLE_PRIORITY, &amp;SupervisorTaskHandle);</code>.</ul><blockquote class="warning"><p>Notice how we are just <strong>passing NULL for the parameter</strong> and that we are <strong>passing the address of the TaskHandle</strong>. If you pass the value directly, your tasks won’t be able to suspend/resume when you attempt to use the functions.</p></blockquote><li>Now we must acknowledge an issue before moving forward. We plan on having several tasks being able to write to the state variable when that thread has deemed the condition should move to the next state (e.g. the <code class="language-plaintext highlighter-rouge">GreenTask</code> task will set the state to <code class="language-plaintext highlighter-rouge">RED_BLINK_START</code>, and the <code class="language-plaintext highlighter-rouge">RedBlinkStartTask</code> task will set the state to <code class="language-plaintext highlighter-rouge">RED</code> and so on.) The issue arises when we have multiple threads with the ability to write to a variable and another thread (e.g. <code class="language-plaintext highlighter-rouge">SupervisorTask</code>) trying to read the variable in our preemptive system. We are going to need to implement a mutex around our state variable to ensure that it is written to by one thread at a time.<ol><li>Go back up to the top of the file where the state variable is globally defined and add the following line below it: <code class="language-plaintext highlighter-rouge">SemaphoreHandle_t state_mutex;</code> Then back in the <code class="language-plaintext highlighter-rouge">main()</code> function, we can setup the mutex with the line: <code class="language-plaintext highlighter-rouge">state_mutex = xSemaphoreCreateMutex();</code><li>With this mutex, we can now try and acquire a lock with <code class="language-plaintext highlighter-rouge">xSemaphoreTake(state_mutex, TRY_TICKS)</code> and we can unlock with <code class="language-plaintext highlighter-rouge">xSemaphoreGive(state_mutex)</code>. Notice <code class="language-plaintext highlighter-rouge">TRY_TICKS</code> in the semaphore take function. It represents the number of RTOS ticks <em>(time unit, by default set to 100 ticks/sec)</em> that the system will try to acquire the lock within, if it cannot within the number provided, it will just fail.<li><p>Now in our <code class="language-plaintext highlighter-rouge">SupervisorTask</code> function infinite loop, we can see if the mutex is locked or unlocked using the return value of the function <code class="language-plaintext highlighter-rouge">xSemaphoreTake()</code> in an if statement:</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">xSemaphoreTake</span><span class="p">(</span><span class="n">state_mutex</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
     <span class="p">{</span>
         <span class="c1">// We have acces to the mutex. Do critical operations here</span>
         <span class="k">switch</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* put FSM logic here */</span> <span class="p">}</span>
                
         <span class="c1">// Release mutex</span>
         <span class="n">xSemaphoreGive</span><span class="p">(</span><span class="n">state_mutex</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div></div><li>Now we can prime which thread needs to run in our Supervisor task similar to how we did in the previous lab with the ready flag being set to true/false.<br /> <code class="language-plaintext highlighter-rouge">vTaskSuspend(/* TaskHandle_t type */)</code> will suspend a task from the scheduler and <code class="language-plaintext highlighter-rouge">vTaskResume(/* TaskHandle_t type */)</code> will add a task back to the pool of tasks to execute. You can add these function calls to the <code class="language-plaintext highlighter-rouge">switch</code> statement cases to set which thread will execute after running the supervisor.<li>At the end of the block of code in each task, we can make the thread go to sleep for a set amount of time. <code class="language-plaintext highlighter-rouge">vTaskDelay(/* num of ticks */)</code> will let the task sleep for a certain number of ticks. Notice this is not seconds, 1 tick = 1/100 seconds. There is a simple macro to convert ticks to seconds that can be used as a parameter in the <code class="language-plaintext highlighter-rouge">vTaskDelay</code> function to sleep for a certain number of milliseconds: <code class="language-plaintext highlighter-rouge">vTaskDelay( pdMS_TO_TICKS(/* ms to sleep */) )</code>.</ol><blockquote class="highlight"><p><strong>Side note,</strong> if you are trying to turn the LEDs on/off for a certain amout of time, calling <code class="language-plaintext highlighter-rouge">vTaskDelay()</code> in that particular task function should make that a trivial task.</p></blockquote><li>To start the kernel, add the line <code class="language-plaintext highlighter-rouge">vTaskStartScheduler();</code> right before the <code class="language-plaintext highlighter-rouge">return</code> statement in the <code class="language-plaintext highlighter-rouge">main</code> function.<li><p>Now that we have gone through the basis of recreating the <code class="language-plaintext highlighter-rouge">taskChoose</code> thread from the previous lab, go ahead a create some tasks that correspond to the other states of the traffice light. You should have all the function calls you need. An example task is given below:</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">void</span> <span class="nf">greenTask</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">button_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

     <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="cm">/* 
         task logic:
         if (button is pressed)
             button flag = 1

         if (take mutex)
             state = RED_BLINK_START
             button flag = 0;
             release mutex
         */</span>

         <span class="cm">/* suspend ourselves */</span>
         <span class="n">vTaskSuspend</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div></div></ol><h2 id="submission"> <a href="#submission" class="anchor-heading" aria-labelledby="submission"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Submission</h2><ol><li>Complete a lab report detailing how you completed this week lab. In your lab report compare and contrast the differences between your design and <a href="https://hthreads.github.io/classes/embedded-systems/labs/lab6">Lab6: Bare Metal TCB</a><li>Submit lab report and code file separately on Blackboard.</ol><h2 id="prelab"> <a href="#prelab" class="anchor-heading" aria-labelledby="prelab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prelab</h2><ul><li>Read the <a href="https://www.freertos.org/FreeRTOS-quick-start-guide.html">FreeRTOS Manual</a>. Expand the section <strong>API Reference</strong> on the left-side menu for full documentation on FreeRTOS function calls.</ul><h2 id="references"> <a href="#references" class="anchor-heading" aria-labelledby="references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> References</h2><ol><li><a href="https://www.freertos.org/FreeRTOS-quick-start-guide.html">FreeRTOS Manual</a></ol></div></div><div class="search-overlay"></div></div>
