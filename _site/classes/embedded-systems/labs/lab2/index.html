<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lab 2 | HThreads</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Lab 2" /><meta name="author" content="Kevin Lin" /><meta property="og:locale" content="en_US" /><meta name="description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><meta property="og:description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><link rel="canonical" href="http://localhost:4000/classes/embedded-systems/labs/lab2/" /><meta property="og:url" content="http://localhost:4000/classes/embedded-systems/labs/lab2/" /><meta property="og:site_name" content="HThreads" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lab 2" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kevin Lin"},"description":"A modern, highly customizable, responsive Jekyll template for course websites","headline":"Lab 2","url":"http://localhost:4000/classes/embedded-systems/labs/lab2/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> HThreads </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Classes category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/" class="nav-list-link">Classes</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in EECS 4213 Computer Architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/computer-architecture/" class="nav-list-link">EECS 4213 Computer Architecture</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/computer-architecture/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/computer-architecture/schedule/" class="nav-list-link">Schedule</a></ul><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in EECS 4114 Embedded Systems category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/embedded-systems/" class="nav-list-link">EECS 4114 Embedded Systems</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/embedded-systems/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/embedded-systems/schedule/" class="nav-list-link">Schedule</a><li class="nav-list-item "> <a href="/classes/embedded-systems/labs/" class="nav-list-link">Labs</a></ul></ul><li class="nav-list-item"><a href="/people/" class="nav-list-link">People</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Projects category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/projects/" class="nav-list-link">Projects</a><ul class="nav-list"><li class="nav-list-item "><a href="/projects/picaso/" class="nav-list-link">PiCaSO</a></ul><li class="nav-list-item"><a href="/publications/" class="nav-list-link">Publications</a><li class="nav-list-item"><a href="/schedule/" class="nav-list-link">Schedule</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search HThreads" aria-label="Search HThreads" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"> <a href="/classes/">Classes</a><li class="breadcrumb-nav-list-item"> <a href="/classes/embedded-systems/">EECS 4114 Embedded Systems</a><li class="breadcrumb-nav-list-item"> <a href="/classes/embedded-systems/labs/">Labs</a><li class="breadcrumb-nav-list-item"> <span>Lab 2</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="lab-2-gpio-peripherals"> <a href="#lab-2-gpio-peripherals" class="anchor-heading" aria-labelledby="lab-2-gpio-peripherals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab 2: GPIO Peripherals</h1><blockquote class="note"><p>Redownload the <a href="https://github.com/tkamucheka/eecs-4114-labs">starter project</a> before attempting this lab. The new starter project incorporates the following changes:</p><ol><li>The AXI SmartConnects are replaced with AXI InterConnects. The AXI SmartConnects’ internal circuitry does not adapt to accommodate addition of new peripherals in this and potentially future labs. This is either by design or a bug in the IP…<li>An additional AXI Instruction port on the MicroBlaze. We’ll need this later in the semester when we move our applications from local memory to DDR memory.</ol><p><strong>Things to do before you start this lab:</strong></p><ol><li>Add the <strong>UARTLite IP</strong> to your design. Following instructions in <a href="/classes/embedded-systems/labs/lab1/#directions" target="_blank">Lab 1: Vivado - Generating a bitstream (4)</a>.<li>Assign an address to the <strong>UARTLite IP</strong> in the “Address Editor” window.<li>Create an HDL wrapper for your block design.</ol></blockquote><h2 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction</h2><p>In lab 1, we started with a basic MicroBlaze SoC, and we added a UART controller which gave us the ability to see the output of our applications. We want to do more with our SoC and the peripherals built into the Arty development board. Therefore, in lab 2, we will add two GPIO controllers to gain access to buttons, switches, and LEDs on our development board. After adding the GPIO controllers, we will synthesize our design and generate a new bitstream. Some boilerplate code is supplied that demonstrates how to connect push button inputs to the green LEDs. When a button is pressed, the corresponding LEDs on the opposite side of the board will light up. You will tinker with the supplied code, and observe how the pointers created are used to perform memory-mapped IO. From there, you will build on the supplied code to add support for the 4 switches on the <a href="/classes/embedded-systems/labs/lab2/assets/datasheets/arty_rm.pdf">Arty board</a> and make them control the corresponding RGB LEDs. In order to complete this laboratory successfully, you will need to understand the workings of the GPIO peripheral by reading the <a href="/classes/embedded-systems/labs/lab2/assets/datasheets/axi-gpio.pdf">GPIO (General Purpose Input/Output)</a>.</p><h2 id="project-assignment"> <a href="#project-assignment" class="anchor-heading" aria-labelledby="project-assignment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project Assignment</h2><ul><li>Create a new application project within SDK to upload to the <a href="/classes/embedded-systems/labs/lab2/assets/datasheets/arty_rm.pdf">Arty</a> development board:<ul><li>Copy and paste the demo C code into your application<li>Load the demo code onto the Arty to observe the pointers in action</ul><li>Add to the existing code to create the following functionality:<ul><li>When SW0 (far right) switch is in the up position, LD0 (far right RGB LED) will glow white.<li>When SW1 switch is in the up position, LD1 will glow white.<li>When SW2 switch is in the up position, LD2 will glow white.<li>When SW3 (far left) switch is in the up position, LD3 (far left) will glow white.<li>When the respective switch is down position, the respective LED will turn off.<li>Just like the buttons in the demo code, when the status of the switches changes, print to the console the current state of the switch register.</ul><li>Please allocate enough time outside of class to read and understand the project and the workings of the <a href="/classes/embedded-systems/labs/lab2/assets/datasheets/axi-gpio.pdf">GPIO</a>.</ul><h2 id="directions"> <a href="#directions" class="anchor-heading" aria-labelledby="directions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Directions</h2><p><strong>Vivado - Block Design:</strong></p><ol><li>In Vivado, open the “Block Design” from the “Flow Navigator” window.<li>Double-click on the <strong>“microblaze_0_periph”</strong> AXI SmartConnect and change “Number of Master Interfaces” to (3). Click “OK” to close the dialog window. You should see two additional ports appear, “M01_AXI” and “M02_AXI”. <img src="/classes/embedded-systems/labs/lab2/assets/images/smartconnect.png" alt="microblaze_0_periph" /><li>Use the “<strong>+ Add IP</strong>” feature to add the AXI GPIO IP to your design:<ol><li>Right-click on the “S_AXI” port on the GPIO controller and select “Make Connection…”.<li>Choose “M01_AXI” in the “Make Connection” window and click “OK” to make the connection.<li>Select “Run Connection Automation”. Then select <strong>“s_axi_clk”</strong> and set “Clock Source:” to <strong>“/mig_7series_0/ui_clk (81 MHz)</strong>.<li>Double-click on the AXI GPIO IP to open the “Re-Customize IP” window.<li>Set the <strong>GPIO</strong> interface to <strong>“led_4bits”</strong> and <strong>GPIO2</strong> to <strong>“push_buttons 4bits”</strong>. Click “OK” to exit the window.<li>Finally, select “Run Connection Automation” again, and select both GPIO and GPIO2 interfaces. Click “OK” to automate the connections. <img src="/classes/embedded-systems/labs/lab2/assets/images/axi_gpio_0.png" alt="AXI GPIO 0" /><li>Use the “Regenerate Layout” button to reorganize things in your block design. <img src="/classes/embedded-systems/labs/lab2/assets/images/regenerate_layout.png" alt="Regenerate Layout" />.</ol><li>Add another AXI GPIO controller to your design:<ol><li>This time, connect the <strong>“S_AXI”</strong> port to <strong>“M02_AXI”</strong> port on <strong>“microblaze_0_periph”</strong>.<li>Use the same 81 MHz clock you used earlier.<li>Then connect <strong>GPIO</strong> and <strong>GPIO2</strong> interfaces to <strong>“rgb led”</strong> and <strong>“dip switch 4bits”</strong> respectively. <img src="/classes/embedded-systems/labs/lab2/assets/images/axi_gpio_1.png" alt="AXI GPIO 1" /></ol><li>Use the “Address Editor” window to assign addresses to the GPIO IPs you just added.<li>Save your block design and generate a new bitstream.<li>Export your hardware, making sure you include the bitstream and Launch the SDK.</ol><p><strong>SDK - Creating Software Project:</strong></p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// GPIO Tutorial Using Pointers</span>

<span class="cm">/*
 * Because printf utilizes a UNIX-like streaming interface that has a buffer,
 * xil_printf is preferred as it has a smaller overhead (1KB), no buffer (it
 * prints immediately), but doesn't support printing floats or long long types.
 */</span>
<span class="cp">#include "xil_printf.h"
</span>
<span class="cm">/*
 * Define statements: These statements are known as "preprocessor directives"
 * as they are essentially macros that are replaced with their values before
 * compilation. These are NOT global variables, just helpful values to refer to
 * constant values. It's a common/best practice to make these macros in CAPS.
 *
 * Again, DO NOT use them in place of variable declarations.
 *
 * It's common in embedded systems to have a "board.h" or "gpio.h" header file
 * referenced that just has all of the useful registers #defined for you.
 */</span>

<span class="cp">#define AXI_GPIO_0_BASE_ADDR 0x40000000
</span>
<span class="cp">#define GREEN_LEDS_BASE_ADDR (AXI_GPIO_0_BASE_ADDR)
#define PUSH_BTNS_BASE_ADDR  (AXI_GPIO_0_BASE_ADDR + 8)
</span>
<span class="cp">#define GREEN_LEDS_REG (unsigned *)(GREEN_LEDS_BASE_ADDR)
#define PUSH_BTNS_REG (unsigned *)(PUSH_BTNS_BASE_ADDR)
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Data and tristate register ptrs for the 4 green LEDs on the Arty board</span>
  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">greenLEDsData</span> <span class="o">=</span> <span class="n">GREEN_LEDS_REG</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">greenLEDsTri</span>  <span class="o">=</span> <span class="n">GREEN_LEDS_REG</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// Data and tristate register ptrs for the 4 push buttons on the Arty board</span>
  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">buttonsData</span> <span class="o">=</span> <span class="n">PUSH_BTNS_REG</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">buttonsTri</span>  <span class="o">=</span> <span class="n">PUSH_BTNS_REG</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// Let's display our addresses now to see what the macros did:</span>
  <span class="c1">// You'll note the tri-state ptrs have an offset of 4 from the "+ 1" above.</span>
  <span class="c1">// This is because the size of an integer takes up 4 bytes, so every + 1 is</span>
  <span class="c1">// really addr + sizeof(int). You can use any base to increment the numbers</span>
  <span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">Begin...</span><span class="se">\r\n\r\n\t</span><span class="s">Register Offsets:</span><span class="se">\r\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">xil_printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">greenLEDsData register </span><span class="se">\t</span><span class="s">= 0x%08x</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">greenLEDsData</span><span class="p">);</span>
  <span class="n">xil_printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">greenLEDsTri register </span><span class="se">\t</span><span class="s">= 0x%08x</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">greenLEDsTri</span><span class="p">);</span>
  <span class="n">xil_printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">buttonsData register </span><span class="se">\t</span><span class="s">= 0x%08x</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">buttonsData</span><span class="p">);</span>
  <span class="n">xil_printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">buttonsTri register </span><span class="se">\t</span><span class="s">= 0x%08x</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">buttonsTri</span><span class="p">);</span>

  <span class="c1">// Set the tri-state direction of the AXI_GPIO_0 pins.</span>
  <span class="c1">// Buttons = inputs, LEDs = outputs</span>
  <span class="c1">// (input = high, output = low)</span>
  <span class="o">*</span><span class="n">greenLEDsTri</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
  <span class="o">*</span><span class="n">buttonsTri</span> <span class="o">=</span> <span class="mh">0xF</span><span class="p">;</span>

  <span class="c1">// Used to determine if the program should print to the console</span>
  <span class="kt">int</span> <span class="n">oldButtonsData</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Infinite loop</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Set the LED register to be the same as the buttons' current reading</span>
    <span class="o">*</span><span class="n">greenLEDsData</span> <span class="o">=</span> <span class="o">*</span><span class="n">buttonsData</span><span class="p">;</span>

    <span class="c1">// To avoid spamming the COM terminal with each loop, let's only print if the</span>
    <span class="c1">// status of the buttons register has changed:</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buttonsData</span> <span class="o">!=</span> <span class="n">oldButtonsData</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">oldButtonsData</span> <span class="o">=</span> <span class="o">*</span><span class="n">buttonsData</span><span class="p">;</span>
        <span class="n">xil_printf</span><span class="p">(</span><span class="s">"buttonsData register: 0x%08x</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">buttonsData</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><ol><li>Create a new application project:<ol><li>Give your application a name (e.g. lab2).<li>For <strong>“Board Support Package:”</strong>, select “Create New”.<li>On the next page, select “Empty Application”, and select “Finish”.<li>Right-click on “lab2/src”, and select “New &gt; Source File”.<li>Enter “main.c” in <strong>“Source File:”</strong> and select “Finish”.<li>Copy the example code into your “main.c” file.<li>Program the FPGA and run the application to see the green LEDs respond to button presses.</ol><li>Add your own code to achieve similar behavior with the dip switches and RGB LEDs:<ul><li>When SW0 (far right) switch is in the up position, LD0 (far right RGB LED) will glow white.<li>When SW1 switch is in the up position, LD1 will glow white.<li>When SW2 switch is in the up position, LD2 will glow white.<li>When SW3 (far left) switch is in the up position, LD3 (far left) will glow white.<li>When the respective switch is down position, the respective LED will turn off.<li>Just like the buttons in the demo code, when the status of the switches changes, print to the console the current state of the switch register.</ul></ol><p class="label label-green"><strong>Hints:</strong></p><ul><li>For RGB LEDs and dip switches, find the memory address of <strong>“axi_gpio_1”</strong> in <strong>“base_soc_wrapper_hw_platform_0/system.hdf”</strong> file. Alternatively, you can find the address in the “Address Editor” window in Vivado.<li>Unlike the green LED register, which is only 4 bits wide, the RGB LED register is 12 bits wide. Starting from the MSB (Most Significant Bit), each LED occupies 3 bits - 1 for each of the RGB (Red, Green, and Blue) channels. The first 3 bits control the right-most LED (LD0). To turn LD0 white, write 1’s to all three color channels (i.e. <code class="language-plaintext highlighter-rouge">0b111</code> or <code class="language-plaintext highlighter-rouge">0x7</code>).<li>You can use bit-wise boolean operations to toggle bits in a register. Refer to class slides on bit twiddling in C.</ul><h2 id="submission"> <a href="#submission" class="anchor-heading" aria-labelledby="submission"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Submission</h2><ol><li>Prepare a lab report, and give an account of what you did to complete the lab.<li>In your lab report, include a screenshot of the 2 AXI GPIO controllers you added to your design.<li>Submit your code file.</ol><h2 id="prelab-assignment"> <a href="#prelab-assignment" class="anchor-heading" aria-labelledby="prelab-assignment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prelab Assignment</h2><ol><li>Read the <a href="/classes/embedded-systems/labs/lab2/assets/datasheets/axi-gpio.pdf">AXI GPIO Datasheet</a>. Familiarize yourself with all the accessible registers inside the IP, and their offsets from the base address.</ol></div></div><div class="search-overlay"></div></div>
