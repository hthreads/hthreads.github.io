<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lab 8 | HThreads</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Lab 8" /><meta name="author" content="Kevin Lin" /><meta property="og:locale" content="en_US" /><meta name="description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><meta property="og:description" content="A modern, highly customizable, responsive Jekyll template for course websites" /><link rel="canonical" href="http://localhost:4000/classes/embedded-systems/labs/lab8/" /><meta property="og:url" content="http://localhost:4000/classes/embedded-systems/labs/lab8/" /><meta property="og:site_name" content="HThreads" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lab 8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kevin Lin"},"description":"A modern, highly customizable, responsive Jekyll template for course websites","headline":"Lab 8","url":"http://localhost:4000/classes/embedded-systems/labs/lab8/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> HThreads </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Classes category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/" class="nav-list-link">Classes</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in EECS 4213 Computer Architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/computer-architecture/" class="nav-list-link">EECS 4213 Computer Architecture</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/computer-architecture/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/computer-architecture/schedule/" class="nav-list-link">Schedule</a></ul><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in EECS 4114 Embedded Systems category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/classes/embedded-systems/" class="nav-list-link">EECS 4114 Embedded Systems</a><ul class="nav-list"><li class="nav-list-item "> <a href="/classes/embedded-systems/syllabus/" class="nav-list-link">Syllabus</a><li class="nav-list-item "> <a href="/classes/embedded-systems/schedule/" class="nav-list-link">Schedule</a><li class="nav-list-item "> <a href="/classes/embedded-systems/labs/" class="nav-list-link">Labs</a></ul></ul><li class="nav-list-item"><a href="/people/" class="nav-list-link">People</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Projects category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/projects/" class="nav-list-link">Projects</a><ul class="nav-list"><li class="nav-list-item "><a href="/projects/picaso/" class="nav-list-link">PiCaSO</a></ul><li class="nav-list-item"><a href="/publications/" class="nav-list-link">Publications</a><li class="nav-list-item"><a href="/schedule/" class="nav-list-link">Schedule</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search HThreads" aria-label="Search HThreads" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"> <a href="/classes/">Classes</a><li class="breadcrumb-nav-list-item"> <a href="/classes/embedded-systems/">EECS 4114 Embedded Systems</a><li class="breadcrumb-nav-list-item"> <a href="/classes/embedded-systems/labs/">Labs</a><li class="breadcrumb-nav-list-item"> <span>Lab 8</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="lab-8-autonomus-vehicle"> <a href="#lab-8-autonomus-vehicle" class="anchor-heading" aria-labelledby="lab-8-autonomus-vehicle"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab 8: Autonomus Vehicle</h1><h2 id="week-1"> <a href="#week-1" class="anchor-heading" aria-labelledby="week-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Week 1</h2><h3 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction</h3><p>This first week is devoted to assembling and testing your autonomous robot car. First you and your partner will modify your SoC to include the peripherals necessary for communication with the car sensors. Then you will follow the video instructions to assemble the shadow chassis, which is the base platform for your Arty Bot. Your TA will be available to help you through the assembly process. Zip ties and “engineering grade” rubber bands will be available in the lab if you need them.</p><h3 id="lab-instructions"> <a href="#lab-instructions" class="anchor-heading" aria-labelledby="lab-instructions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab Instructions</h3><blockquote class="note"><p>Go to GitHub, and download and extract the <a href="https://github.com/tkamucheka/eecs-4114-labs">base-soc repository</a> again. Open the extracted directory and copy the “ip_repo” directory. Paste the copied directory in your project directory next to the “base-soc” directory. If you already have an “ip_repo” directory, overwrite it.</p></blockquote><ol><li>Now let us make some changes to our SoC (System on Chip). Start by opening your project in Vivado. In the <strong>Flow Navigator</strong> on the left side, navigate to <strong>“Open Block Design.”</strong><li>To add our downloaded IP to Vivado, navigate to <strong>“Project Settings”</strong> to open the <strong>Project Settings</strong> dialog. In the left panel select <strong>“IP,”</strong> then select the <strong>“Repository Manager”</strong> tab. Now add the IP repository folder you copied earlier. Select <strong>“Apply”</strong> and close the dialog.<li><p>Back in the block design of your SoC. We want to add IP to the SoC for communicating with the external Pmod peripherals. We will add AXI GPIO, Pmod_DHB1, and Pmod_Dual_MAXSONAR IP for communication with the two line detecting light sensors, Pmod MAXSONAR sensor, and Pmod DHB1 motor driver.</p><blockquote class="warning"><p><strong>Do not use connection automation…</strong></p></blockquote><ol><li><strong>AXI GPIO » jA » Pmod LS1:</strong><ul><li>Using the <strong>+ Add IP</strong> button and dialog. Add a new <strong>AXI GPIO</strong> and <strong>Pmod Bridge</strong> IP to your design.<li>Connect the <strong>S_AXI</strong> bus port of the AXI GPIO to a port on the interconnect.<li>Connect the two GPIO ports on the AXI GPIO with the <strong>GPIO_Top_Row</strong> and <strong>GPIO_Bottom_Row</strong> on the Pmod Bridge.<li>Finally, in the “Board” window on the left, right-click the <strong>jA</strong> port under Pmod and select “connect component.” In the dialog that appears, find the Pmod bridge you just added and select the <strong>Pmod_out</strong> port as your connection. One more thing, enable interrupts for the AXI GPIO.</ul><li><strong>Pmod_Dual_MAXSONAR » jB » Pmod MAXSONAR:</strong><ul><li>Add the <strong>Pmod_Dual_MAXSONAR</strong> IP and connect it to a Pmod Bridge.<li>You can connect the <strong>Pmod_out</strong> port of the Pmod Bridge to the <strong>jB</strong> Pmod port.</ul><li><strong>Pmod_DHB1 » jD » Pmod DHB1:</strong><ul><li>Add the <strong>Pmod_DHB1_v1_0</strong> IP and connect it to the <strong>jD</strong> Pmod port through a Pmod Bridge.</ul></ol><li>Go to “Address Editor” window of the block design and assign memory addresses to the newly added IP.<li>Validate your design and generate a bitstream.<li>Watch the assembly <a href="https://www.youtube.com/watch?v=aJRYTqZu5OE">instruction video</a> or follow the <a href="https://learn.sparkfun.com/tutorials/assembly-guide-for-redbot-with-shadow-chassis">instructions given here</a> to assembly the chassis of your robot.</ol><h3 id="project-assignment"> <a href="#project-assignment" class="anchor-heading" aria-labelledby="project-assignment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project Assignment</h3><ol><li>Mount the two IR (infrared) Proximity sensors somewhere on the front of car. Try to mount them as close as possible to the floor. Connect the sensors to one of S1, S2, S3, or S4 pin headers on the Pmod LS1 module. Finally, connect the Pmod LS1 module to the Arty board via the Pmod port you connected the AXI GPIO in the board design.<li>Mount the two Pmod MAXSONAR sensors on the front of the car. Use the provided Pmod extension cables to connect the sensors to the Pmod port where you connected the AXI GPIO in the board design. Connect one sensor to the bottom row of the Pmod port and the other to the top row of the same Pmod port.<li>Connect the Pmod DHB1 to the Arty board via the Pmod port you selected in the board design. Now make the following connections on the Pmod DHB1 module:<ol><li>Connect the left and right motors to the screw terminals J5 and J6.<li>Connect the Hall effect sensors to J7 and J8. The red wire is VCC, black is GND, and white is motor feedback. The motor feedback signal is used to count wheel revolutions using the Hall effect sensors.<li>Connect the AA battery pack to the screw terminal at J4.</ol></ol><h3 id="prelab-assignment"> <a href="#prelab-assignment" class="anchor-heading" aria-labelledby="prelab-assignment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prelab Assignment</h3><p>Take a look at the manuals listed in the references sections</p><ol><li><a href="https://www.hackster.io/atang08/artybot-551478">Tang, A. ArtyBot - A two-wheel robotics platform built on the Arty development board. Hackster.io</a><li><a href="https://digilent.com/reference/_media/reference/pmod/pmod-interface-specification-1_3_1.pdf">Pmod Interface Specification</a><li><a href="https://digilent.com/reference/pmod/pmodls1/reference-manual">Pmod LS1 Reference Manual</a><li><a href="https://digilent.com/reference/pmod/pmodmaxsonar/reference-manual">Pmod MAXSONAR Reference Manual</a><li><a href="https://digilent.com/reference/pmod/pmoddhb1/reference-manual">Pmod DHB1 Reference Manual</a></ol><hr /><h2 id="week-2"> <a href="#week-2" class="anchor-heading" aria-labelledby="week-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Week 2</h2><h3 id="introduction-1"> <a href="#introduction-1" class="anchor-heading" aria-labelledby="introduction-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction</h3><p>Now that you have assembled your car, the next step in our journey is learning how to flash programs onto FPGA boards. Doing so will cause the FPGA board to automatically load your program from flash memory as soon as you connect the board to a power source to the board. In order to accomplish this, we will have to make one more modification to the SoC.</p><h3 id="lab-instructions-1"> <a href="#lab-instructions-1" class="anchor-heading" aria-labelledby="lab-instructions-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab Instructions</h3><p><strong>Vivado:</strong></p><p>We’re going to add the SPI Flash Memory to our design. The instructions below will walk you through the process.</p><ol><li>Open your project in Vivado. In the <strong>Flow Navigator</strong>, navigate to <strong>“Open Block Design”</strong>.<li>Start by adding a port to the <strong>“microblaze_0_axi_mem”</strong> interconnect.<li>Time to add the <strong>“AXI Quad SPI”</strong> flash memory controller:<ol><li>Navigate to the <strong>“Board”</strong> window.<li>Right-click on the <strong>“Quad SPI Flash”</strong> and select <strong>“Auto Connect”</strong>. This should add a new IP block to your design.<li>Next, connect the <strong>“AXI_LITE”</strong> port to the <strong>“microblaze_0_axi_mem”</strong> interconnect.<li>Use the <strong>“Connection Automation”</strong> feature to make the following connections:<ul><li><strong>ext_spi_clk:</strong> <code class="language-plaintext highlighter-rouge">/mig_7series_0/ui_clk (81 MHz)</code><li><strong>s_axi_aclk:</strong> <code class="language-plaintext highlighter-rouge">/mig_7series_0/ui_clk (81 MHz)</code><li><strong>M01_ACLK:</strong> <code class="language-plaintext highlighter-rouge">/mig_7series_0/ui_clk (81 MHz)</code></ul><li>Finally, assign an address to the memory controller.</ol><li>Double-click on the <strong>“AXI Quad Flash”</strong> controller to open the <strong>“Re-customize IP”</strong> window:<ul><li>Under <strong>“IP Configuration”</strong>, change the <strong>“Slave Device”</strong> option to <code class="language-plaintext highlighter-rouge">Spansion</code>.<li>Select <strong>“OK”</strong> to save the changes and close the window.</ul><li>Validate your design, and generate a bitstream.<li>Export your bitstream. Remember, to select to <strong>“include bitstream”</strong> option.</ol><blockquote class="info"><p>Spansion is the manufacturer of the SPI flash memory chip on the FPGA board.</p><p>– <a href="https://digilent.com/reference/programmable-logic/arty-a7/reference-manual#quad-spi_flash">follow this link for more details</a>.</p></blockquote><p><strong>SDK:</strong></p><ol><li>Download <a href="https://github.com/tkamucheka/embedded-systems-lab/tree/main">this GitHub repo</a>, and look at the example applications in the <strong>“embedded_systems_lab.sdk”</strong> directory. The examples demonstrate how to use the sensors and control the motors on your car.<li>Download the <a href="/classes/embedded-systems/labs/lab8/assets/slides/Board-Flashing-Instructions.pdf">Board Flashing Guide</a>. The guide will show you how to flash how to flash any application onto your FPGA board. You can use any application from the “Fayetteville Bike Crossing” series to test the process.<li>Design an application capable of following the line and driving your car around the track.<li>Top 5 fastest cars get 5 points towards final grade.</ol><blockquote class="hint-title"><p>Hints:</p><ol><li>The light sensors will pick up reflections from shiny objects. Use them to detect the reflective tape on track.<li>The sonar sensors API function will return a distance value in inches. When you test them, point them towards a large open area. Spaces with many objects nearby will give you false readings.<li>Test the functionality of your sensor on your desk first before moving to the track. This will save you a lot of time during development.<li>If you get stuck, ask for help.<li>While I recommend using FreeRTOS, you are free to design your application however you see fit. Remember, there are bonus points on the line. Take them by any means necessary!</ol><p><strong>Good luck!</strong></p></blockquote><h3 id="project-assignment-1"> <a href="#project-assignment-1" class="anchor-heading" aria-labelledby="project-assignment-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project Assignment</h3><blockquote class="note"><p>The PDF instructions have more details and illustration images.</p></blockquote><ul><li>Turn your car into a line following robot. The line will be a (silver) duct tape track and your car should drive around the track with wheels on either side of the track. There will be an obstacle at the end of the track, use this to stop your car. To do this:<ul><li>Use the <strong>GPIO PMOD LS1</strong> to detect when your car drives over the line and steer that car back onto the track<li>Use the <strong>PMOD MAXSONAR</strong> to detect obstacles and stop the car before the obstacle.<li>Program the Arty’s non-volatile 16 MB Quad-SPI flash memory with your SoC and application so that your application runs when you power on the Arty board. <strong>NB:</strong> the file names in this section may be different from what you have in your project. Just remember what you named your SoC in Vivado and project name in the SDK and the rest should look familiar. If you are unsure ask your TA for help. To program your Arty:<li>Right-click your project folder, the project you want to flash onto the board, and select <strong>Generate Linker Script</strong>. On the right side, change all 3 dropdowns from <code class="language-plaintext highlighter-rouge">microblaze_0_local</code>… to <code class="language-plaintext highlighter-rouge">mig_7series_0_memaddr</code>. If you are on Linux this might not work. You may need to open the <strong>lscript.ld</strong> file in your project’s <code class="language-plaintext highlighter-rouge">src</code> directory and manually change all the entries to <code class="language-plaintext highlighter-rouge">mig_7series_0_memaddr</code>.<li>Click the <strong>Program Flash</strong> button in the toolbar. Next to Image File, click Browse and navigate to your project folder, then into Debug. Select your_project_name.elf and click open. Next to Offset, enter <code class="language-plaintext highlighter-rouge">0x00C00000</code>. This is the address offset where your program will be stored in the flash memory. Next to ‘Flash Type,’ select <em>S25FL128sxxxxxx0-spi-x1_x2_x4</em>. <strong>IMPORTANT</strong>, make sure ‘Convert ELF to bootloadable SREC format and program’ is checked. Click <strong>Program</strong>.<li>To create a bootloader, in the toolbar select File &gt; New &gt; Application Project. Name the project something like ‘bootloader’ as shown in the image above. Click <strong>Next</strong>.<li>Select <strong>SREC SPI Bootloader</strong>, and select <strong>Finish</strong>.<li>We need to make a few changes to our bootloader before loading it onto the Arty board. First, we need to set the ‘address offset’ so the bootloader can find our application. In the ‘Bootloader’ project, open the <strong>blconfig.h</strong> file and change the <strong>FLASH_IMAGE_BASEADDR</strong> to <code class="language-plaintext highlighter-rouge">0x00C00000</code>. Note, this same address you used when you flashed your application onto the flash memory earlier.<li><blockquote><p><strong>Optional</strong>, if you wish to improve your ArtyBot’s startup time. Edit the file bootloader.c and comment out the line <code class="language-plaintext highlighter-rouge">#define VERBOSE</code>. This will turn off console logging. <strong>NB:</strong> Console logs may be useful when you’re initially setting things up.</p></blockquote><li>Click the <strong>Program FPGA</strong> button in the toolbar. In the right half of the Software Configuration section, there is a cell that says <code class="language-plaintext highlighter-rouge">bootloop</code>. Click the right side of this cell to reveal a drop-down menu. Select <strong>Bootloop.elf</strong> from the list, then click Program. This will generate a bit file with the MicroBlaze’s memory initialized with the program that you have written. The Arty is also programmed and if everything went well you should see your application running in your favorite console application (e.g. SDK Terminal, Putty or TeraTerm)<li>Almost there, click the <strong>Program Flash</strong> button in the toolbar. Next to Image File, click Browse and navigate to the SDK workspace, then into <code class="language-plaintext highlighter-rouge">base_soc_wrapper_hw_platform_0</code>. Select <code class="language-plaintext highlighter-rouge">download.bit</code> and click <strong>Open</strong>. Next of Offset, enter <code class="language-plaintext highlighter-rouge">0x0</code>. Next to Flash Type, select <code class="language-plaintext highlighter-rouge">S25FL128sxxxxxx0-spi-x1_x2_x4</code>. Click <strong>Program</strong>.<li>Congratulations, you have flashed the bootloader and your application to the non-volatile SPI Qflash memory. Next time you power on the board, the bootloader will be copied from the flash memory and when it runs, it will execute your application.</ul></ul><h3 id="prelab-assignment-1"> <a href="#prelab-assignment-1" class="anchor-heading" aria-labelledby="prelab-assignment-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prelab Assignment</h3><p>None this week. Lucky you!</p><h3 id="references"> <a href="#references" class="anchor-heading" aria-labelledby="references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> References</h3><ol><li>FreeRTOS Manual <a href="https://www.freertos.org/FreeRTOS-quick-start-guide.html">https://www.freertos.org/FreeRTOS-quick-start-guide.html</a> (expand API Reference on the side for full documentation on function calls)<li><a href="https://www.hackster.io/atang08/artybot-551478">Tang, A. ArtyBot - A two-wheel robotics platform built on the Arty development board. Hackster.io</a></ol></div></div><div class="search-overlay"></div></div>
